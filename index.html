<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>INT's</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
      integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
      crossorigin="anonymous"
    ></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Newsreader:ital,opsz,wght@0,6..72,200..800;1,6..72,200..800&display=swap");
  
      body {
        margin: 0;
      }
  
      .header {
        padding-top: 40px;
        padding-left: 3px;
        background-color: #ffffff;
        height: 90px;
        align-items: center;
        justify-content: center;
        display: flex;
      }
  
      .header>div {
        color: #000000;
        font-family: "Newsreader", serif;
        font-size: 3rem;
      }
  
      .main {
        display: flex;
        flex-direction: column;
        position: relative;
      }
  
      #myCarousel {
        width: 1330px;
        height: 512px;
        margin-top: 45px;
        margin-bottom: 40px;
        margin-left: auto;
        margin-right: auto;
        justify-content: center;
        align-items: center;
      }
  
      .carousel-caption {
        top: 1.5rem;
        text-align: center !important;
      }
  
      .carousel-caption>h1 {
        margin-bottom: 3rem;
      }
  
      #rows-container {
        display: flex;
        justify-content: center;
        width: 70vw;
      }
  
      .row {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        justify-items: center;
      }
  
      .col-lg-3 {
        text-align: center;
        border-style: solid;
        border-width: 1.5px;
        border-radius: 5px;
        padding: 2rem 0.5rem;
        margin: 10px;
        width: 80%;
      }
  
      .bar {
        width: 210px;
        height: 5px;
        margin-left: auto;
        margin-right: auto;
        margin-bottom: 0px;
        background-color: black;
      }
  
      .carousel-inner {
        border-radius: 5px;
      }

      .fw-normal {
        margin-top: 2rem;
      }

      .uid {
        display: none;
      }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
      import {
        collection,
        getDocs,
        getFirestore,
        addDoc,
      } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

      function make_card(name, image, count, uid) {
        return `<div class="col-lg-3">
            <img height=140 width= 140 src="${image}" alt="...">
            <h2 class="fw-normal" id="card-${count}">${name}</h2>
            <p>
              And lastly this, the third column of representative placeholder
              content.
            </p>
            <p>
              <a class="btn btn-secondary" id="detail-btn-${count}">View details »</a>
            </p>
            <p class="uid">${uid}</p>
          </div>`;
      }

      const firebaseConfig = {
        apiKey: "AIzaSyBym678ZRXfWjzc5Us-JTMV9ljzXLgtM4I",
        authDomain: "nbc-sa.firebaseapp.com",
        projectId: "nbc-sa",
        storageBucket: "nbc-sa.appspot.com",
        messagingSenderId: "479626176899",
        appId: "1:479626176899:web:5c5ddc73093628df63aeb6",
        measurementId: "G-QD9WK29W17",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      const querySnapshot = await getDocs(collection(db, "cards"));
      const card_rows = $("#card-rows");
      querySnapshot.forEach((doc, i) => {
        const { name, image } = doc.data();
        const temp_html = make_card(name, image, i, doc.id);
        card_rows.append(temp_html);
      });

      let detail_btn_click = (uid)=> () => {
        let current_href = window.location.href;
        if (current_href.split("/").slice(-1)[0].includes("html")) {
          window.location =
            current_href.split("/").slice(0, -1).join("/") +
            "/detail.html?uid=" +
            uid;
        } else {
          window.location = current_href + "detail.html?uid=" + uid;
        }
      }

      Array.from(card_rows.children()).forEach((card, i) => {
        let uid = card.getElementsByClassName("uid");
        if (i == 0) return
        // onclick은 parameter를 넘겨줄 수 없어서 커링으로 일단 인자를 받도록 함
        card.onclick=detail_btn_click(card.getElementsByClassName("uid")[0].textContent);
      })

      const add_card_form = `<div class="col-lg-3">
            <svg
              class="bd-placeholder-img rounded-circle"
              width="140"
              height="140"
              xmlns="http://www.w3.org/2000/svg"
              role="img"
              aria-label="Placeholder"
              preserveAspectRatio="xMidYMid slice"
              focusable="false"
            >
              <title>Placeholder</title>
              <rect
                width="100%"
                height="100%"
                fill="var(--bs-secondary-color)"
              ></rect>
            </svg>
            <h2 class="fw-normal" id="add_card">추가</h2>
            <p>새 멤버를 추가하세요.</p>
            <p>
              <button
                class="btn btn-secondary"
                data-bs-toggle="modal"
                data-bs-target="#addModal"
              >
                멤버 추가하기 »
              </button>
            </p>
          </div>`;

      card_rows.append(add_card_form);

      async function add_card() {
        const name = document.querySelector("input[id=name]").value;
        const mbti = document.querySelector("input[id=mbti]").value;
        const strength = document.querySelector("input[id=strength]").value;
        const style = document.querySelector("input[id=style]").value;
        const blog = document.querySelector("input[id=blog]").value;
        const image = document.querySelector("input[id=image]").value;
        const password = document.querySelector("input[id=pwd]").value;


        const doc = { name, mbti, strength, style, blog, image, password, isMember:false };

        const docref = await addDoc(collection(db, "cards"), doc);
        let card_rows = $("#card-rows");
        const cards_cnt = card_rows.children().length;
        
        let temp_html = make_card(name, image, cards_cnt);

        card_rows.children().last().remove();
        card_rows.append(temp_html);
        card_rows.children().last().click(detail_btn_click(docref.id));
        card_rows.append(add_card_form);

        document.querySelector("#close-btn").click();
      }

      function validation() {
        const pwd = $("#pwd").val();
        const pwdCheck = $("#pwdCheck").val();
        if (pwd !== pwdCheck) {
          alert("비밀번호가 일치하지 않습니다.");
        } else {
          add_card();
        }
      }

      document.querySelector("#add-btn").onclick = validation;
    </script>
  </head>
  <body>
    <div class="header"><div>INT's</div></div>
    <div class="bar"></div>
    <div class="main">
      <div id="myCarousel" class="carousel slide mb-6">
        <div class="carousel-indicators">
          <button
            type="button"
            data-bs-target="#myCarousel"
            data-bs-slide-to="0"
            class="active"
            aria-label="Slide 1"
            aria-current="true"
          ></button>
          <button
            type="button"
            data-bs-target="#myCarousel"
            data-bs-slide-to="1"
            aria-label="Slide 2"
            class=""
          ></button>
          <button
            type="button"
            data-bs-target="#myCarousel"
            data-bs-slide-to="2"
            aria-label="Slide 3"
            class=""
          ></button>
        </div>
        <div class="carousel-inner">
          <div class="carousel-item active">
            <svg
              class="bd-placeholder-img"
              width="100%"
              height="512px"
              xmlns="http://www.w3.org/2000/svg"
              aria-hidden="true"
              preserveAspectRatio="xMidYMid slice"
              focusable="false"
            >
              <rect width="100%" height="100%" fill="#5939F9"></rect>
            </svg>
            <div class="container">
              <div class="carousel-caption text-start">
                <h1>팀 소개</h1>
                <h3>
                  Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed
                  mattis fringilla commodo. Donec at magna in lorem vehicula
                  tempus ullamcorper id leo.
                </h3>
              </div>
            </div>
          </div>
          <div class="carousel-item">
            <svg
              class="bd-placeholder-img"
              width="100%"
              height="512px"
              xmlns="http://www.w3.org/2000/svg"
              aria-hidden="true"
              preserveAspectRatio="xMidYMid slice"
              focusable="false"
            >
              <rect width="100%" height="100%" fill="#836BFB"></rect>
            </svg>
            <div class="container">
              <div class="carousel-caption">
                <h1>팀 목표</h1>
                <h3>
                  Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed
                  mattis fringilla commodo. Donec at magna in lorem vehicula
                  tempus ullamcorper id leo.
                </h3>
              </div>
            </div>
          </div>
          <div class="carousel-item">
            <svg
              class="bd-placeholder-img"
              width="100%"
              height="512px"
              xmlns="http://www.w3.org/2000/svg"
              aria-hidden="true"
              preserveAspectRatio="xMidYMid slice"
              focusable="false"
            >
              <rect width="100%" height="100%" fill="#B4A5FC"></rect>
            </svg>
            <div class="container">
              <div class="carousel-caption text-end">
                <h1>팀 시간 약속</h1>
                <h3>
                  Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed
                  mattis fringilla commodo. Donec at magna in lorem vehicula
                  tempus ullamcorper id leo.
                </h3>
              </div>
            </div>
          </div>
        </div>
        <button
          class="carousel-control-prev"
          type="button"
          data-bs-target="#myCarousel"
          data-bs-slide="prev"
        >
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button
          class="carousel-control-next"
          type="button"
          data-bs-target="#myCarousel"
          data-bs-slide="next"
        >
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
        </button>
      </div>
      <div class="container" id="rows-container">
        <div class="row" id="card-rows">
          <!-- <div class="col-lg-3">
            <svg
              class="bd-placeholder-img rounded-circle"
              width="140"
              height="140"
              xmlns="http://www.w3.org/2000/svg"
              role="img"
              aria-label="Placeholder"
              preserveAspectRatio="xMidYMid slice"
              focusable="false"
            >
              <title>Placeholder</title>
              <rect
                width="100%"
                height="100%"
                fill="var(--bs-secondary-color)"
              ></rect>
            </svg>
            <h2 class="fw-normal" id="card-1">김태완</h2>
            <p>
              Some representative placeholder content for the three columns of
              text below the carousel. This is the first column.
            </p>
            <p>
              <a class="btn btn-secondary" id="detail-btn-1">View details »</a>
            </p>
          </div>
          <div class="col-lg-3">
            <svg
              class="bd-placeholder-img rounded-circle"
              width="140"
              height="140"
              xmlns="http://www.w3.org/2000/svg"
              role="img"
              aria-label="Placeholder"
              preserveAspectRatio="xMidYMid slice"
              focusable="false"
            >
              <title>Placeholder</title>
              <rect
                width="100%"
                height="100%"
                fill="var(--bs-secondary-color)"
              ></rect>
            </svg>
            <h2 class="fw-normal" id="card-2">오지석</h2>
            <p>
              Another exciting bit of representative placeholder content. This
              time, we've moved on to the second column.
            </p>
            <p>
              <a class="btn btn-secondary" id="detail-btn-2">View details »</a>
            </p>
          </div>
          <div class="col-lg-3">
            <svg
              class="bd-placeholder-img rounded-circle"
              width="140"
              height="140"
              xmlns="http://www.w3.org/2000/svg"
              role="img"
              aria-label="Placeholder"
              preserveAspectRatio="xMidYMid slice"
              focusable="false"
            >
              <title>Placeholder</title>
              <rect
                width="100%"
                height="100%"
                fill="var(--bs-secondary-color)"
              ></rect>
            </svg>
            <h2 class="fw-normal" id="card-3">김도균</h2>
            <p>
              And lastly this, the third column of representative placeholder
              content.
            </p>
            <p>
              <a class="btn btn-secondary" id="detail-btn-3">View details »</a>
            </p>
          </div>
          <div class="col-lg-3">
            <svg
              class="bd-placeholder-img rounded-circle"
              width="140"
              height="140"
              xmlns="http://www.w3.org/2000/svg"
              role="img"
              aria-label="Placeholder"
              preserveAspectRatio="xMidYMid slice"
              focusable="false"
            >
              <title>Placeholder</title>
              <rect
                width="100%"
                height="100%"
                fill="var(--bs-secondary-color)"
              ></rect>
            </svg>
            <h2 class="fw-normal" id="card-4">이수진</h2>
            <p>
              And lastly this, the third column of representative placeholder
              content.
            </p>
            <p>
              <a class="btn btn-secondary" id="detail-btn-4">View details »</a>
            </p>
          </div>
          <div class="col-lg-3">
            <svg
              class="bd-placeholder-img rounded-circle"
              width="140"
              height="140"
              xmlns="http://www.w3.org/2000/svg"
              role="img"
              aria-label="Placeholder"
              preserveAspectRatio="xMidYMid slice"
              focusable="false"
            >
              <title>Placeholder</title>
              <rect
                width="100%"
                height="100%"
                fill="var(--bs-secondary-color)"
              ></rect>
            </svg>
            <h2 class="fw-normal" id="card-5">추가</h2>
            <p>새 멤버를 추가하세요.</p>
            <p>
              <button
                class="btn btn-secondary"
                data-bs-toggle="modal"
                data-bs-target="#addModal"
              >
                멤버 추가하기 »
              </button>
            </p>
          </div>
        </div>
      </div>
    </div>

  -->
     <div
      class="modal fade"
      id="addModal"
      tabindex="-1"
      aria-labelledby="addModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalLabel">
              새 멤버 추가
            </h1>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="input-group mb-3">
              <span class="input-group-text">이름</span>
              <input
                id="name"
                type="text"
                class="form-control"
                aria-label="name"
                aria-describedby="name"
              />
            </div>
            <div class="input-group mb-3">
              <span class="input-group-text">MBTI</span>
              <input
                id="mbti"
                type="text"
                class="form-control"
                aria-label="mbti"
                aria-describedby="mbti"
              />
            </div>
            <div class="input-group mb-3">
              <span class="input-group-text">장점</span>
              <input
                id="strength"
                type="text"
                class="form-control"
                aria-label="strength"
                aria-describedby="strength"
              />
            </div>
            <div class="input-group mb-3">
              <span class="input-group-text">스타일</span>
              <input
                id="style"
                type="text"
                class="form-control"
                aria-label="style"
                aria-describedby="style"
              />
            </div>
            <div class="input-group mb-3">
              <span class="input-group-text">블로그 주소</span>
              <input
                id="blog"
                type="text"
                class="form-control"
                aria-label="blog"
                aria-describedby="blog"
              />
            </div>

            <div class="input-group mb-3">
              <span class="input-group-text">이미지 주소</span>
              <input
                id="image"
                type="text"
                class="form-control"
                aria-label="image"
                aria-describedby="image"
              />
            </div>
            <div class="input-group mb-3">
              <span class="input-group-text">비밀번호</span>
              <input
                id="pwd"
                type="password"
                class="form-control"
                aria-label="pwd"
                aria-describedby="pwd"
              />
            </div>
            <div class="input-group mb-3">
              <span class="input-group-text">비밀번호 확인</span>
              <input
                id="pwdCheck"
                type="password"
                class="form-control"
                aria-label="pwdCheck"
                aria-describedby="pwdCheck"
              />
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
              id="close-btn"
            >
              닫기
            </button>
            <button type="button" class="btn btn-primary" id="add-btn">
              추가하기
            </button>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
